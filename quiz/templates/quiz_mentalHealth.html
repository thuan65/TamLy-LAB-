<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i test s·ª©c kho·∫ª tinh th·∫ßn</title>
</head>
<body>
    <h2>B√†i test PHQ-9</h2>

    <!-- üß© Th√™m ph·∫ßn nh·∫≠p th√¥ng tin sinh vi√™n t·∫°i ƒë√¢y -->
    <form id="quizForm">
        <label><b>H·ªç v√† t√™n</b></label><br>
        <input type="text" id="ho_ten" placeholder="Nguy·ªÖn VƒÉn A" required style="width:100%; padding:8px;"><br><br>

        <label><b>M√£ s·ªë sinh vi√™n (MSSV)</b></label><br>
        <input type="text" id="mssv" placeholder="2412345" required style="width:100%; padding:8px;"><br><br>

        <hr><br>
    </form>

    <button onclick="submitQuiz()">N·ªôp b√†i</button>

    <div id="result"></div>


<script>
// === Load c√¢u h·ªèi t·ª´ API ===
async function loadQuestions() {
    const res = await fetch('/api/lay-cau-hoi');
    const data = await res.json();

    const form = document.getElementById('quizForm');

    data.cau_hoi.forEach((cauHoi, index) => {
        let html = `<p><b>${index + 1}. ${cauHoi}</b></p>`;
        
        data.tan_suat.forEach((label, value) => {
            html += `
                <label>
                    <input type="radio" name="q${index}" value="${value}">
                    ${label}
                </label><br>
            `;
        });

        form.innerHTML += html + "<br>";
    });

    // C√¢u h·ªèi m·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng
    form.innerHTML += `<br><b>M·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng ƒë·∫øn cu·ªôc s·ªëng:</b><br>`;
    data.anh_huong.forEach((label, value) => {
        form.innerHTML += `
            <label>
                <input type="radio" name="impact" value="${value}"> ${label}
            </label><br>
        `;
    });
}

// === Submit form ===
async function submitQuiz() {
    let answers = [];
    for (let i = 0; i < 9; i++) {
        const choice = document.querySelector(`input[name="q${i}"]:checked`);
        if (!choice) return alert("Vui l√≤ng tr·∫£ l·ªùi ƒë·∫ßy ƒë·ªß 9 c√¢u!");
        answers.push(Number(choice.value));
    }

    const impactChoice = document.querySelector(`input[name="impact"]:checked`);
    if (!impactChoice) return alert("Vui l√≤ng ch·ªçn m·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng!");

    const res = await fetch('/api/nop-bai', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            tra_loi: answers,
            anh_huong: Number(impactChoice.value)
        })
    });

    const data = await res.json();
    showResult(data);
}

// === Hi·ªÉn th·ªã k·∫øt qu·∫£ ===
function showResult(data) {
    const box = document.getElementById('result');
    box.innerHTML = `
        <h3 style="color:green;">${data.msg || "‚úÖ ƒê√£ n·ªôp form th√†nh c√¥ng!"}</h3>
        <h3>K·∫øt qu·∫£:</h3>
        <p><b>ƒêi·ªÉm:</b> ${data.diem}</p>
        <p><b>M·ª©c ƒë·ªô:</b> ${data.muc_do}</p>
        <p><b>·∫¢nh h∆∞·ªüng:</b> ${data.anh_huong_text}</p>
        <b>L·ªùi khuy√™n:</b>
        <ul>
            ${data.loi_khuyen.map(item => `<li>${item}</li>`).join('')}
        </ul>
    `;
}


// T·ª± load c√¢u h·ªèi khi m·ªü trang
loadQuestions();
</script>

</body>
</html>
